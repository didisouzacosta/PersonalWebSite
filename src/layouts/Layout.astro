---
import '../styles/global.css'
import Controls from '../components/Controls.astro';

interface Props {
    title: string,
    description?: string,
    ogImage?: string,
    favicon?: string,
    lang?: string,
    metas?: { name: string, content: string }[]
}

const {
    title,
    description,
    ogImage = 'https://avatars.githubusercontent.com/u/11352503?v=4',
    favicon,
    lang = 'en',
    metas = []
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- Theme init (must be before CSS to avoid FOUC) -->
        <script is:inline>
            (function() {
                var saved = localStorage.getItem('theme');
                var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', saved || (prefersDark ? 'dark' : 'light'));
            })();
        </script>

        <link rel="icon" type="image/png" href={`https://pub-81dc0daed73f4a358469301b9b80f493.r2.dev/favicon/${favicon ?? "favicon-32x32.png"}`} />
        <meta name="generator" content={Astro.generator} />
        <meta name="robots" content="index, follow">
        <link rel="canonical" href="https://adrianosouzacosta.com.br">
        <meta name="description" content={description}>

        <!-- Open Graph -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://adrianosouzacosta.com.br" />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={ogImage} />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={ogImage} />

        {
            metas.map((meta) => <meta name={meta.name} content={meta.content}>)
        }

        <title>{title}</title>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-BSDWW4LMHQ"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-BSDWW4LMHQ');
        </script>
    </head>
    <body>
        <Controls lang={lang} currentPath={Astro.url.pathname} />
        <slot />
        <script is:inline>
            var observer = new IntersectionObserver(
                function(entries) {
                    entries.forEach(function(e) {
                        if (e.isIntersecting) {
                            e.target.classList.add('visible');
                            observer.unobserve(e.target);
                        }
                    });
                },
                { threshold: 0.15 }
            );
            document.querySelectorAll('.fade-in').forEach(function(el) { observer.observe(el); });
        </script>
    </body>
</html>
